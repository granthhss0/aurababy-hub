<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Movement Hub</title>

<!-- React (UMD) -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

<!-- Babel (THIS IS WHAT FIXES YOUR ERROR) -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Socket.IO CLIENT -->
<script src="https://aurababy-hub0.onrender.com/socket.io/socket.io.js"></script>

<style>
/* === YOUR CSS UNCHANGED === */
* { margin:0; padding:0; box-sizing:border-box }
body { overflow:hidden; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto }
.screen { width:100vw;height:100vh;background:linear-gradient(135deg,#1e3a8a,#581c87,#312e81);position:relative }
.grid-bg { position:absolute; inset:0; opacity:.2;
background-image:linear-gradient(rgba(255,255,255,.1) 1px,transparent 1px),
linear-gradient(90deg,rgba(255,255,255,.1) 1px,transparent 1px);
background-size:50px 50px }
.player { position:absolute;width:48px;height:48px;border-radius:8px }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

/* SOCKET CONNECTION */
const socket = io("https://aurababy-hub0.onrender.com", {
  transports: ["websocket"]
});

function MovementHub() {
  const [username, setUsername] = useState(null);
  const [inputUsername, setInputUsername] = useState("");
  const [players, setPlayers] = useState({});
  const [position, setPosition] = useState({ x: 200, y: 200 });

  const idRef = useRef(crypto.randomUUID());
  const keys = useRef({});

  /* SOCKET EVENTS */
  useEffect(() => {
    socket.on("players", data => setPlayers(data));
    socket.on("disconnect", () => console.log("socket disconnected"));

    return () => {
      socket.off("players");
    };
  }, []);

  /* MOVEMENT */
  useEffect(() => {
    if (!username) return;

    const loop = () => {
      let dx = 0, dy = 0;
      if (keys.current.w) dy -= 4;
      if (keys.current.s) dy += 4;
      if (keys.current.a) dx -= 4;
      if (keys.current.d) dx += 4;

      setPosition(p => {
        const next = { x: p.x + dx, y: p.y + dy };
        socket.emit("move", {
          id: idRef.current,
          username,
          ...next
        });
        return next;
      });

      requestAnimationFrame(loop);
    };

    requestAnimationFrame(loop);
  }, [username]);

  /* KEY HANDLERS */
  useEffect(() => {
    const down = e => keys.current[e.key.toLowerCase()] = true;
    const up = e => keys.current[e.key.toLowerCase()] = false;
    window.addEventListener("keydown", down);
    window.addEventListener("keyup", up);
    return () => {
      window.removeEventListener("keydown", down);
      window.removeEventListener("keyup", up);
    };
  }, []);

  if (!username) {
    return (
      <div className="screen center-container">
        <div className="welcome-box">
          <h1>Welcome</h1>
          <input
            value={inputUsername}
            onChange={e => setInputUsername(e.target.value)}
            placeholder="Username"
          />
          <button onClick={() => setUsername(inputUsername)}>
            Start
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="screen">
      <div className="grid-bg" />
      {Object.values(players).map(p => (
        <div
          key={p.id}
          className="player"
          style={{ left:p.x, top:p.y, background:"#22d3ee" }}
        />
      ))}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root"))
  .render(<MovementHub />);
</script>
</body>
</html>
