<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Movement Hub</title>

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<!-- Socket.IO -->
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
.screen{width:100vw;height:100vh;background:linear-gradient(135deg,#1e3a8a 0%,#581c87 50%,#312e81 100%);position:relative;overflow:hidden}
.grid-bg{position:absolute;inset:0;opacity:.2;background-image:
linear-gradient(rgba(255,255,255,.1) 1px,transparent 1px),
linear-gradient(90deg,rgba(255,255,255,.1) 1px,transparent 1px);
background-size:50px 50px}
.player{position:absolute;width:48px;height:48px;border-radius:8px;box-shadow:0 0 20px rgba(34,211,238,.6)}
.username-label{position:absolute;background:rgba(0,0,0,.7);color:#22d3ee;
padding:4px 12px;border-radius:6px;font-size:14px;font-weight:bold;
transform:translateX(-50%);pointer-events:none}
.hud{position:absolute;top:16px;left:16px;background:rgba(0,0,0,.5);
backdrop-filter:blur(10px);color:white;padding:12px 16px;border-radius:8px}
.babies-button{width:100%;margin-bottom:8px;padding:8px;border:none;border-radius:6px;
background:linear-gradient(90deg,#22d3ee,#3b82f6);color:white;font-weight:bold;cursor:pointer}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);
display:flex;align-items:center;justify-content:center;z-index:1000}
.modal{background:rgba(0,0,0,.9);border:2px solid rgba(34,211,238,.5);
border-radius:16px;padding:32px;width:90%;max-width:700px}
.modal-title{color:#22d3ee;font-size:28px;font-weight:bold;text-align:center;margin-bottom:24px}
.character-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.character-option{background:rgba(255,255,255,.05);
border:2px solid rgba(255,255,255,.2);border-radius:12px;padding:12px;
cursor:pointer;text-align:center}
.character-option.selected{border-color:#22d3ee;background:rgba(34,211,238,.2)}
.character-image{width:100%;height:120px;object-fit:contain;margin-bottom:8px}
.character-name{color:white;font-weight:bold;font-size:14px}
.center-container{display:flex;align-items:center;justify-content:center;width:100vw;height:100vh}
.welcome-box{background:rgba(0,0,0,.5);padding:32px;border-radius:16px;
width:90%;max-width:400px;color:white}
.input{width:100%;padding:12px;border-radius:8px;
background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.3);
color:white;margin-bottom:16px}
.button{width:100%;padding:12px;border-radius:8px;
background:linear-gradient(90deg,#22d3ee,#3b82f6);
border:none;color:white;font-weight:bold;cursor:pointer}
.error{background:rgba(239,68,68,.2);border:1px solid #ef4444;
color:#fecaca;padding:12px;border-radius:8px;margin-bottom:16px}
</style>
</head>

<body>
<div id="root"></div>

<script>
/* ================= PROOF ================= */
console.log("SOCKET TARGET =", "https://aurababy-hub0.onrender.com");

/* ================= SOCKET (FORCED) ================= */
const socket = io("https://aurababy-hub0.onrender.com", {
  autoConnect: false,
  transports: ["websocket"],   // ðŸ”’ NO polling, NO same-origin fallback
  path: "/socket.io"
});

socket.connect();

/* ================= APP ================= */
const { useState, useEffect, useRef } = React;

const characters = {
  aurababy:{name:"Aurababy",image:"https://i.ibb.co/nq467xv6/aurababy.png"},
  goonerbaby:{name:"Goonerbaby",image:"https://i.ibb.co/ZRPGHj01/goonerbaby.png"},
  fattiebaby:{name:"Fattie Baby",image:"https://i.ibb.co/Kj0gKt2Q/fattiebaby.png"},
  zoely:{name:"Zoely",image:"https://i.ibb.co/PsXr9KgX/zoely.png"},
  hollybaby:{name:"Holly Baby",image:"https://i.ibb.co/DD8Py8yW/hollybaby.png"},
  jollybaby:{name:"Jolly Baby",image:"https://i.ibb.co/8DNHS4n9/jollybaby.png"}
};

function MovementHub(){
  const [username,setUsername]=useState(localStorage.getItem("movement_hub_username"));
  const [input,setInput]=useState("");
  const [error,setError]=useState("");
  const [players,setPlayers]=useState({});
  const [selectedCharacter,setSelectedCharacter]=useState("aurababy");
  const [showModal,setShowModal]=useState(false);

  const pos=useRef({x:200,y:200});
  const keys=useRef({});

  useEffect(()=>{
    socket.on("state", data=>{
      console.log("STATE RECEIVED", data);
      setPlayers(data);
    });
    return ()=>socket.off("state");
  },[]);

  useEffect(()=>{
    if(username){
      socket.emit("join",{ username, character:selectedCharacter });
    }
  },[username, selectedCharacter]);

  useEffect(()=>{
    if(!username) return;
    const down=e=>keys.current[e.key.toLowerCase()]=true;
    const up=e=>keys.current[e.key.toLowerCase()]=false;
    window.addEventListener("keydown",down);
    window.addEventListener("keyup",up);

    const loop=()=>{
      let dx=0,dy=0;
      if(keys.current.w||keys.current.arrowup)dy--;
      if(keys.current.s||keys.current.arrowdown)dy++;
      if(keys.current.a||keys.current.arrowleft)dx--;
      if(keys.current.d||keys.current.arrowright)dx++;
      pos.current.x+=dx*4;
      pos.current.y+=dy*4;
      socket.emit("move",{x:pos.current.x,y:pos.current.y});
      requestAnimationFrame(loop);
    };
    loop();
  },[username]);

  if(!username){
    return React.createElement("div",{className:"screen center-container"},
      React.createElement("div",{className:"welcome-box"},
        React.createElement("form",{onSubmit:e=>{
          e.preventDefault();
          if(input.length<3)return setError("Min 3 chars");
          localStorage.setItem("movement_hub_username",input);
          setUsername(input);
        }},
          React.createElement("input",{className:"input",value:input,onChange:e=>setInput(e.target.value),placeholder:"Username"}),
          error&&React.createElement("div",{className:"error"},error),
          React.createElement("button",{className:"button"},"Start")
        )
      )
    );
  }

  return React.createElement("div",{className:"screen"},
    React.createElement("div",{className:"grid-bg"}),

    Object.values(players).map(p=>
      React.createElement(React.Fragment,{key:p.id},
        React.createElement("div",{className:"player",style:{left:p.x,top:p.y}},
          React.createElement("img",{src:characters[p.character]?.image,
            style:{width:"100%",height:"100%",objectFit:"contain"}})
        ),
        React.createElement("div",{className:"username-label",
          style:{left:p.x+24,top:p.y+58}},p.username)
      )
    ),

    React.createElement("div",{className:"hud"},
      React.createElement("button",{className:"babies-button",
        onClick:()=>setShowModal(true)},"ðŸ‘¶ Babies")
    ),

    showModal&&React.createElement("div",{className:"modal-overlay",
      onClick:()=>setShowModal(false)},
      React.createElement("div",{className:"modal",
        onClick:e=>e.stopPropagation()},
        React.createElement("div",{className:"modal-title"},"Choose Your Character"),
        React.createElement("div",{className:"character-grid"},
          Object.entries(characters).map(([k,c])=>
            React.createElement("div",{key:k,
              className:`character-option ${selectedCharacter===k?"selected":""}`,
              onClick:()=>{
                setSelectedCharacter(k);
                socket.emit("character",k);
                setShowModal(false);
              }},
              React.createElement("img",{src:c.image,className:"character-image"}),
              React.createElement("div",{className:"character-name"},c.name)
            )
          )
        )
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById("root"))
  .render(React.createElement(MovementHub));
</script>
</body>
</html>
