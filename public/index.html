<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Movement Hub</title>

<!-- Socket.IO -->
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<style>
/* === ALL YOUR ORIGINAL CSS â€” UNCHANGED === */
* { margin:0; padding:0; box-sizing:border-box }
body { margin:0; padding:0; overflow:hidden; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif }
.screen { width:100vw; height:100vh; background:linear-gradient(135deg,#1e3a8a 0%,#581c87 50%,#312e81 100%); position:relative; overflow:hidden }
.grid-bg { position:absolute; inset:0; opacity:.2; background-image:linear-gradient(rgba(255,255,255,.1) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.1) 1px,transparent 1px); background-size:50px 50px }
.player { position:absolute; width:48px; height:48px; border-radius:8px; box-shadow:0 0 20px rgba(34,211,238,.6); transition:all 75ms; overflow:hidden }
.hud { position:absolute; top:16px; left:16px; background:rgba(0,0,0,.5); backdrop-filter:blur(10px); color:white; padding:12px 16px; border-radius:8px }
.babies-button,.admin-button{ width:100%; border:none; cursor:pointer; border-radius:6px; font-weight:700 }
.babies-button{ background:linear-gradient(90deg,#22d3ee,#3b82f6); padding:8px 16px; margin-bottom:8px }
.admin-button{ background:linear-gradient(90deg,#f97316,#ef4444); padding:8px 12px }
.modal-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.7); display:flex; align-items:center; justify-content:center; z-index:1000 }
.modal{ background:rgba(0,0,0,.9); border:2px solid rgba(34,211,238,.5); border-radius:16px; padding:24px; width:92%; max-width:900px; color:white }
.character-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px }
.character-option{ border:2px solid rgba(255,255,255,.12); border-radius:12px; padding:12px; cursor:pointer }
.character-option.selected{ border-color:#22d3ee; background:rgba(34,211,238,.12) }
.username-label{ position:absolute; transform:translateX(-50%); background:rgba(0,0,0,.7); color:#22d3ee; padding:4px 12px; border-radius:6px; font-weight:700 }
.username-label.admin{ background:linear-gradient(90deg,red,orange,yellow,green,blue,indigo,violet); color:white }
.center-container{ display:flex; align-items:center; justify-content:center; width:100vw; height:100vh }
.welcome-box{ background:rgba(0,0,0,.5); backdrop-filter:blur(16px); padding:32px; border-radius:16px; width:90%; max-width:420px }
.input{ width:100%; padding:12px; border-radius:8px; background:rgba(255,255,255,.06); color:white; border:1px solid rgba(255,255,255,.2) }
.button{ width:100%; padding:12px; border:none; border-radius:8px; background:linear-gradient(90deg,#22d3ee,#3b82f6); color:white; font-weight:700 }
.top-announcement{ position:fixed; top:18px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.6); padding:12px 20px; border-radius:10px; z-index:2000 }
.mod-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.85); display:flex; align-items:center; justify-content:center; z-index:3000 }
</style>
</head>

<body>
<div id="root"></div>

<script type="module">
import React from "https://cdn.skypack.dev/react@18.2.0";
import ReactDOM from "https://cdn.skypack.dev/react-dom@18.2.0";
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue, get, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* ===== SOCKET.IO ===== */
const socket = io("https://aurababy-hub0.onrender.com", {
  transports: ["websocket"]
});

/* ===== FIREBASE (MODERATION ONLY) ===== */
const firebaseConfig = {
  apiKey: "AIzaSyBbgy76ThxHaKlOhpiLQ6Nw4ekR1b9t3DA",
  databaseURL: "https://s0lace-web-default-rtdb.firebaseio.com"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const { useState, useEffect, useRef } = React;

function MovementHub(){
  const [username,setUsername]=useState(null);
  const [inputUsername,setInputUsername]=useState("");
  const [error,setError]=useState("");
  const [players,setPlayers]=useState({});
  const [position,setPosition]=useState({x:200,y:200});
  const [character,setCharacter]=useState("aurababy");
  const [announcement,setAnnouncement]=useState(null);
  const [selfModeration,setSelfModeration]=useState(null);

  const playerId=useRef(crypto.randomUUID());
  const keys=useRef({});
  const renderRef=useRef({});

  const characters={
    aurababy:{image:"https://i.ibb.co/nq467xv6/aurababy.png"},
    goonerbaby:{image:"https://i.ibb.co/ZRPGHj01/goonerbaby.png"},
    fattiebaby:{image:"https://i.ibb.co/Kj0gKt2Q/fattiebaby.png"}
  };

  /* === LOGIN === */
  const submit=async()=>{
    if(inputUsername.length<3) return setError("Too short");
    setUsername(inputUsername);
    socket.emit("join",{
      id:playerId.current,
      username:inputUsername,
      character
    });
  };

  /* === SOCKET STATE === */
  useEffect(()=>{
    socket.on("state",state=>setPlayers(state||{}));
    socket.on("kick",data=>setSelfModeration(data));
    return()=>{socket.off("state");socket.off("kick")};
  },[]);

  /* === MOVEMENT === */
  useEffect(()=>{
    const down=e=>keys.current[e.key]=true;
    const up=e=>keys.current[e.key]=false;
    window.addEventListener("keydown",down);
    window.addEventListener("keyup",up);

    const loop=()=>{
      if(!username) return requestAnimationFrame(loop);
      let dx=0,dy=0;
      if(keys.current.w)dy-=4;
      if(keys.current.s)dy+=4;
      if(keys.current.a)dx-=4;
      if(keys.current.d)dx+=4;
      if(dx||dy){
        setPosition(p=>{
          const nx=p.x+dx, ny=p.y+dy;
          socket.emit("move",{x:nx,y:ny});
          return{x:nx,y:ny};
        });
      }
      requestAnimationFrame(loop);
    };
    loop();
    return()=>{window.removeEventListener("keydown",down);window.removeEventListener("keyup",up)};
  },[username]);

  /* === RENDER === */
  if(!username){
    return React.createElement("div",{className:"screen center-container"},
      React.createElement("div",{className:"welcome-box"},
        React.createElement("input",{className:"input",value:inputUsername,onChange:e=>setInputUsername(e.target.value)}),
        error && React.createElement("div",null,error),
        React.createElement("button",{className:"button",onClick:submit},"Join")
      )
    );
  }

  return React.createElement("div",{className:"screen"},
    React.createElement("div",{className:"grid-bg"}),
    Object.entries(players).map(([id,p])=>
      React.createElement(React.Fragment,{key:id},
        React.createElement("div",{className:"player",style:{left:p.x,top:p.y}},
          React.createElement("img",{src:characters[p.character]?.image})
        ),
        React.createElement("div",{className:"username-label",style:{left:p.x+24,top:p.y+58}},p.username)
      )
    ),
    selfModeration && React.createElement("div",{className:"mod-overlay"},"You are moderated")
  );
}

ReactDOM.render(React.createElement(MovementHub),document.getElementById("root"));
</script>
</body>
</html>
