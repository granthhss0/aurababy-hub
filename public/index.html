<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Movement Hub</title>

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://aurababy-hub0.onrender.com/socket.io/socket.io.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto}
.screen{width:100vw;height:100vh;background:linear-gradient(135deg,#1e3a8a,#581c87,#312e81);position:relative}
.grid-bg{position:absolute;inset:0;opacity:.2;
background-image:linear-gradient(rgba(255,255,255,.1) 1px,transparent 1px),
linear-gradient(90deg,rgba(255,255,255,.1) 1px,transparent 1px);
background-size:50px 50px}
.player{position:absolute;width:48px;height:48px;border-radius:8px;
background:linear-gradient(135deg,#22d3ee,#3b82f6);
box-shadow:0 0 20px rgba(34,211,238,.6)}
.username-label{
position:absolute;
transform:translateX(-50%);
top:52px;
background:rgba(0,0,0,.7);
color:#22d3ee;
padding:4px 10px;
border-radius:6px;
font-weight:700;
font-size:13px;
white-space:nowrap
}
.center-container{display:flex;align-items:center;justify-content:center}
.welcome-box{
background:rgba(0,0,0,.5);
backdrop-filter:blur(16px);
border-radius:16px;
padding:32px;
width:360px;
color:white
}
.input{width:100%;padding:12px;border-radius:8px;border:none;margin-bottom:12px}
.button{width:100%;padding:12px;border-radius:8px;border:none;
background:linear-gradient(90deg,#22d3ee,#3b82f6);
color:white;font-weight:700;cursor:pointer}
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

const socket = io("https://aurababy-hub0.onrender.com", {
  transports:["websocket"]
});

function App(){
  const [username,setUsername]=useState(null);
  const [input,setInput]=useState("");
  const [players,setPlayers]=useState({});
  const pos=useRef({x:200,y:200});
  const id=useRef(crypto.randomUUID());
  const keys=useRef({});

  useEffect(()=>{
    socket.on("player-update", data=>{
      setPlayers(p=>({...p,[data.id]:data}));
    });
    socket.on("player-disconnect", pid=>{
      setPlayers(p=>{
        const n={...p};
        delete n[pid];
        return n;
      });
    });
  },[]);

  useEffect(()=>{
    if(!username) return;

    socket.emit("join",{
      id:id.current,
      username,
      ...pos.current
    });

    const loop=()=>{
      let dx=0,dy=0;
      if(keys.current.w) dy-=4;
      if(keys.current.s) dy+=4;
      if(keys.current.a) dx-=4;
      if(keys.current.d) dx+=4;

      pos.current.x+=dx;
      pos.current.y+=dy;

      socket.emit("move",{
        id:id.current,
        username,
        ...pos.current
      });

      requestAnimationFrame(loop);
    };
    loop();
  },[username]);

  useEffect(()=>{
    const d=e=>keys.current[e.key.toLowerCase()]=true;
    const u=e=>keys.current[e.key.toLowerCase()]=false;
    window.addEventListener("keydown",d);
    window.addEventListener("keyup",u);
    return()=>{window.removeEventListener("keydown",d);window.removeEventListener("keyup",u);}
  },[]);

  if(!username){
    return(
      <div className="screen center-container">
        <div className="welcome-box">
          <h1 style={{marginBottom:12}}>Welcome</h1>
          <input className="input" placeholder="Username"
            value={input} onChange={e=>setInput(e.target.value)}/>
          <button className="button" onClick={()=>setUsername(input)}>Start</button>
        </div>
      </div>
    );
  }

  return(
    <div className="screen">
      <div className="grid-bg"/>
      {Object.values(players).map(p=>(
        <div key={p.id} style={{left:p.x,top:p.y}} className="player">
          <div className="username-label">{p.username}</div>
        </div>
      ))}
    </div>
  );
}

ReactDOM.createRoot(root).render(<App/>);
</script>
</body>
</html>
