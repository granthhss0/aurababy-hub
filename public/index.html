<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Movement Hub</title>

<!-- ðŸ”’ STYLES UNTOUCHED -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@800;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{overflow:hidden;font-family:Poppins,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
.screen{width:100vw;height:100vh;background:linear-gradient(135deg,#1e3a8a,#581c87 50%,#312e81);position:relative;overflow:hidden}
.grid-bg{position:absolute;inset:0;opacity:.2;background-image:linear-gradient(rgba(255,255,255,.1)1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.1)1px,transparent 1px);background-size:50px 50px}
.player{position:absolute;width:48px;height:48px;border-radius:8px;box-shadow:0 0 20px rgba(34,211,238,.6);transition:all 75ms;overflow:hidden}
.username-label{position:absolute;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);color:#22d3ee;padding:4px 12px;border-radius:6px;font-size:14px;font-weight:800;transform:translateX(-50%)}
.username-label.admin{background:linear-gradient(90deg,red,orange,yellow,green,blue,indigo,violet);color:#fff}
.hud{position:absolute;top:16px;left:16px;background:rgba(0,0,0,.5);backdrop-filter:blur(10px);color:#fff;padding:12px 16px;border-radius:8px}
.babies-button,.admin-button{width:100%;padding:8px;border-radius:6px;border:none;font-weight:800;cursor:pointer;margin-bottom:6px}
.babies-button{background:linear-gradient(90deg,#22d3ee,#3b82f6)}
.admin-button{background:linear-gradient(90deg,#f97316,#ef4444)}
.center-container{display:flex;align-items:center;justify-content:center}
.welcome-box{background:rgba(0,0,0,.5);backdrop-filter:blur(16px);border-radius:16px;padding:32px;width:90%;max-width:420px}
.input{width:100%;padding:12px;border-radius:8px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.2);color:white;margin-bottom:12px}
.button{width:100%;padding:12px;border-radius:8px;border:none;font-weight:900;background:linear-gradient(90deg,#22d3ee,#3b82f6);cursor:pointer}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:1000}
.modal{background:rgba(0,0,0,.9);border:2px solid rgba(34,211,238,.5);border-radius:16px;padding:24px;width:92%;max-width:900px;color:white}
.character-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.character-option{border:2px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;cursor:pointer;text-align:center}
.character-option.selected{border-color:#22d3ee;background:rgba(34,211,238,.12)}
.character-image{width:100%;height:120px;object-fit:contain}
</style>
</head>

<body>
<div id="root"></div>

<!-- Socket.IO -->
<script src="/socket.io/socket.io.js"></script>

<script type="module">
import React from "https://cdn.skypack.dev/react@18.2.0";
import ReactDOM from "https://cdn.skypack.dev/react-dom@18.2.0";

const { useState, useEffect, useRef } = React;
const socket = io();

const characters = {
  aurababy:{image:"https://i.ibb.co/nq467xv6/aurababy.png"},
  goonerbaby:{image:"https://i.ibb.co/ZRPGHj01/goonerbaby.png"},
  fattiebaby:{image:"https://i.ibb.co/Kj0gKt2Q/fattiebaby.png"},
  zoely:{image:"https://i.ibb.co/PsXr9KgX/zoely.png"},
  hollybaby:{image:"https://i.ibb.co/DD8Py8yW/hollybaby.png"},
  jollybaby:{image:"https://i.ibb.co/8DNHS4n9/jollybaby.png"}
};

function MovementHub(){
  const [username,setUsername]=useState(null);
  const [input,setInput]=useState("");
  const [players,setPlayers]=useState({});
  const [position,setPosition]=useState({x:200,y:200});
  const [character,setCharacter]=useState("aurababy");
  const [showChars,setShowChars]=useState(false);
  const playerId=useRef(crypto.randomUUID());
  const keys=useRef({});

  /* ðŸ”‘ LOGIN */
  if(!username){
    return React.createElement("div",{className:"screen center-container"},
      React.createElement("div",{className:"welcome-box"},
        React.createElement("input",{className:"input",placeholder:"Username",value:input,onChange:e=>setInput(e.target.value)}),
        React.createElement("button",{className:"button",onClick:()=>setUsername(input.trim())},"Enter")
      )
    );
  }

  /* ðŸ”Œ SOCKET SYNC */
  useEffect(()=>{
    socket.emit("join",{id:playerId.current,username,character,x:position.x,y:position.y});
    socket.on("players",setPlayers);
    return ()=>socket.off("players");
  },[username]);

  /* ðŸ§ FORCE LOCAL PLAYER VISIBILITY */
  useEffect(()=>{
    setPlayers(p=>({
      ...p,
      [playerId.current]:{id:playerId.current,username,character,x:position.x,y:position.y}
    }));
    socket.emit("move",{id:playerId.current,x:position.x,y:position.y,character});
  },[position,character]);

  /* ðŸŽ® MOVEMENT */
  useEffect(()=>{
    const down=e=>keys.current[e.key]=true;
    const up=e=>keys.current[e.key]=false;
    const tick=()=>{
      setPosition(p=>{
        let x=p.x,y=p.y;
        if(keys.current.w)x-=4;
        if(keys.current.s)y+=4;
        if(keys.current.a)x-=4;
        if(keys.current.d)x+=4;
        return{x:Math.max(0,x),y:Math.max(0,y)};
      });
      requestAnimationFrame(tick);
    };
    window.addEventListener("keydown",down);
    window.addEventListener("keyup",up);
    tick();
    return()=>{window.removeEventListener("keydown",down);window.removeEventListener("keyup",up)};
  },[]);

  return React.createElement("div",{className:"screen"},
    React.createElement("div",{className:"grid-bg"}),

    Object.values(players).map(p=>
      React.createElement(React.Fragment,{key:p.id},
        React.createElement("div",{className:"player",style:{left:p.x,top:p.y}},
          React.createElement("img",{src:characters[p.character]?.image,style:{width:"100%",height:"100%"}})
        ),
        React.createElement("div",{className:"username-label",style:{left:p.x+24,top:p.y+56}},p.username)
      )
    ),

    React.createElement("div",{className:"hud"},
      React.createElement("button",{className:"babies-button",onClick:()=>setShowChars(true)},"ðŸ‘¶ Babies")
    ),

    showChars && React.createElement("div",{className:"modal-overlay",onClick:()=>setShowChars(false)},
      React.createElement("div",{className:"modal",onClick:e=>e.stopPropagation()},
        React.createElement("div",{className:"character-grid"},
          Object.keys(characters).map(k=>
            React.createElement("div",{key:k,className:"character-option"+(character===k?" selected":""),onClick:()=>{setCharacter(k);setShowChars(false)}},
              React.createElement("img",{className:"character-image",src:characters[k].image})
            )
          )
        )
      )
    )
  );
}

ReactDOM.render(React.createElement(MovementHub),document.getElementById("root"));
</script>
</body>
</html>
