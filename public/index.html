<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Movement Hub</title>

  <!-- Socket.IO CLIENT (CDN – REQUIRED) -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"
          crossorigin="anonymous"></script>

  <!-- React (UMD – NO MODULES) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{overflow:hidden;font-family:system-ui}
    .screen{width:100vw;height:100vh;background:linear-gradient(135deg,#1e3a8a,#581c87,#312e81);position:relative}
    .player{position:absolute;width:48px;height:48px;background:#22d3ee;border-radius:8px}
    .name{position:absolute;color:white;font-size:12px;transform:translateX(-50%)}
    .login{position:absolute;inset:0;display:flex;align-items:center;justify-content:center}
    .box{background:#0008;padding:20px;border-radius:12px;color:white}
    input,button{padding:10px;border-radius:8px;border:none;margin-top:8px;width:100%}
    button{background:#22d3ee;font-weight:bold;cursor:pointer}
  </style>
</head>

<body>
<div id="root"></div>

<script>
/* ===== SOCKET CONNECTION (THIS WAS YOUR BUG) ===== */
const socket = io("https://aurababy-hub0.onrender.com", {
  transports: ["websocket"]
});

/* ===== REACT ===== */
const { useState, useEffect, useRef } = React;

function App(){
  const [name,setName]=useState("");
  const [joined,setJoined]=useState(false);
  const [players,setPlayers]=useState({});
  const pos=useRef({x:200,y:200});
  const keys=useRef({});

  useEffect(()=>{
    socket.on("state", state => {
      setPlayers(state || {});
    });
  },[]);

  useEffect(()=>{
    if(!joined) return;

    socket.emit("join",{username:name});

    const down=e=>keys.current[e.key]=true;
    const up=e=>keys.current[e.key]=false;
    window.addEventListener("keydown",down);
    window.addEventListener("keyup",up);

    const loop=()=>{
      if(keys.current.w) pos.current.y-=3;
      if(keys.current.s) pos.current.y+=3;
      if(keys.current.a) pos.current.x-=3;
      if(keys.current.d) pos.current.x+=3;

      socket.emit("move",pos.current);
      requestAnimationFrame(loop);
    };
    loop();

    return ()=>{
      window.removeEventListener("keydown",down);
      window.removeEventListener("keyup",up);
    };
  },[joined]);

  if(!joined){
    return React.createElement("div",{className:"login"},
      React.createElement("div",{className:"box"},
        React.createElement("h2",null,"Enter Username"),
        React.createElement("input",{value:name,onChange:e=>setName(e.target.value)}),
        React.createElement("button",{onClick:()=>name&&setJoined(true)},"Join")
      )
    );
  }

  return React.createElement("div",{className:"screen"},
    Object.values(players).map(p =>
      React.createElement(React.Fragment,{key:p.id},
        React.createElement("div",{className:"player",style:{left:p.x,top:p.y}}),
        React.createElement("div",{className:"name",style:{left:p.x+24,top:p.y+52}},p.username)
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById("root"))
  .render(React.createElement(App));
</script>
</body>
</html>
