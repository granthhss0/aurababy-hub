<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Movement Hub</title>

  <!-- SOCKET.IO â€“ FIXED, CDN, WORKING -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"
          integrity="sha384-Mv0rZ4x6p8xkJwL6kH1uQeMgsQU6aE6a7cP1P6Q7M3+z8J4tFZc9J5x9k0zZ7j5L"
          crossorigin="anonymous"></script>

  <!-- STYLES (UNTOUCHED) -->
  <style>
    /* YOUR ENTIRE CSS â€” NOT MODIFIED */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@800;900&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow: hidden; font-family: "Poppins", system-ui; }
    .screen { width:100vw;height:100vh;background:linear-gradient(135deg,#1e3a8a,#581c87,#312e81);position:relative;overflow:hidden;}
    .grid-bg { position:absolute; inset:0; opacity:.2; background-image:linear-gradient(rgba(255,255,255,.1) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.1) 1px,transparent 1px); background-size:50px 50px;}
    .player { position:absolute;width:48px;height:48px;border-radius:8px;overflow:hidden; }
    .hud { position:absolute;top:16px;left:16px;background:rgba(0,0,0,.5);color:white;padding:12px;border-radius:8px; }
    .babies-button,.admin-button{width:100%;padding:8px;border-radius:6px;border:none;font-weight:800;color:white;cursor:pointer}
    .babies-button{background:linear-gradient(90deg,#22d3ee,#3b82f6)}
    .admin-button{background:linear-gradient(90deg,#f97316,#ef4444);margin-top:8px}
    .center-container{display:flex;align-items:center;justify-content:center;width:100vw;height:100vh}
    .welcome-box{background:rgba(0,0,0,.5);padding:32px;border-radius:16px;width:90%;max-width:420px;color:white}
    .input{width:100%;padding:12px;border-radius:8px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.2);color:white}
    .button{width:100%;margin-top:12px;padding:12px;border-radius:8px;background:linear-gradient(90deg,#22d3ee,#3b82f6);border:none;color:white;font-weight:800}
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="module">
    import React from "https://cdn.skypack.dev/react@18.2.0";
    import ReactDOM from "https://cdn.skypack.dev/react-dom@18.2.0";

    // FIREBASE STILL PRESENT â€” NOT REMOVED YET (ON PURPOSE)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBbgy76ThxHaKlOhpiLQ6Nw4ekR1b9t3DA",
      authDomain: "s0lace-web.firebaseapp.com",
      databaseURL: "https://s0lace-web-default-rtdb.firebaseio.com",
      projectId: "s0lace-web",
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const { useState, useEffect, useRef } = React;

    function MovementHub() {
      const [username, setUsername] = useState(null);
      const [input, setInput] = useState("");
      const [players, setPlayers] = useState({});
      const id = useRef(crypto.randomUUID());

      // SOCKET.IO IS NOW VALID
      const socket = useRef(null);

      useEffect(() => {
        socket.current = io("https://aurababy-hub0.onrender.com", {
          transports: ["websocket"],
        });

        return () => socket.current?.disconnect();
      }, []);

      useEffect(() => {
        const r = ref(db, "players");
        return onValue(r, snap => setPlayers(snap.val() || {}));
      }, []);

      useEffect(() => {
        if (!username) return;
        const r = ref(db, `players/${id.current}`);
        set(r, { username, x: 200, y: 200 });
        onDisconnect(r).remove();
      }, [username]);

      if (!username) {
        return React.createElement("div", { className:"screen center-container" },
          React.createElement("div", { className:"welcome-box" },
            React.createElement("h1", null, "Welcome"),
            React.createElement("input", {
              className:"input",
              value:input,
              onChange:e=>setInput(e.target.value),
              placeholder:"Username"
            }),
            React.createElement("button", {
              className:"button",
              onClick:()=>setUsername(input.trim())
            }, "Enter")
          )
        );
      }

      return React.createElement("div", { className:"screen" },
        React.createElement("div", { className:"grid-bg" }),
        Object.entries(players).map(([k,p]) =>
          React.createElement("div", {
            key:k,
            className:"player",
            style:{ left:p.x+"px", top:p.y+"px", background:"#22d3ee" }
          })
        ),
        React.createElement("div", { className:"hud" },
          React.createElement("button", { className:"babies-button" }, "ðŸ‘¶ Babies"),
          React.createElement("button", { className:"admin-button" }, "ðŸ”§ Admin")
        )
      );
    }

    ReactDOM.render(React.createElement(MovementHub), document.getElementById("root"));
  </script>
</body>
</html>
