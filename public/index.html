<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movement Hub</title>

<!-- React (UMD ONLY) -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<!-- Socket.IO (CDN ONLY) -->
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
.screen{width:100vw;height:100vh;background:linear-gradient(135deg,#1e3a8a,#581c87,#312e81);position:relative}
.grid-bg{position:absolute;inset:0;opacity:.2;background-image:
linear-gradient(rgba(255,255,255,.1) 1px,transparent 1px),
linear-gradient(90deg,rgba(255,255,255,.1) 1px,transparent 1px);
background-size:50px 50px}
.player{position:absolute;width:48px;height:48px}
.username-label{position:absolute;background:rgba(0,0,0,.7);color:#22d3ee;
padding:4px 10px;border-radius:6px;font-size:13px;font-weight:bold;
transform:translateX(-50%)}
.hud{position:absolute;top:16px;left:16px;background:rgba(0,0,0,.5);
backdrop-filter:blur(10px);padding:12px;border-radius:8px;color:white}
.babies-button{width:100%;padding:8px;border:none;border-radius:6px;
background:linear-gradient(90deg,#22d3ee,#3b82f6);color:white;font-weight:bold}
.center{display:flex;align-items:center;justify-content:center;width:100vw;height:100vh}
.box{background:rgba(0,0,0,.5);padding:32px;border-radius:16px;color:white;width:90%;max-width:400px}
.input{width:100%;padding:12px;margin-bottom:16px;border-radius:8px;border:none}
.button{width:100%;padding:12px;border:none;border-radius:8px;
background:linear-gradient(90deg,#22d3ee,#3b82f6);color:white;font-weight:bold}
</style>
</head>

<body>
<div id="root"></div>

<script>
/* ===== ABSOLUTE PROOF ===== */
console.log("FRONTEND JS LOADED");
console.log("SOCKET TARGET â†’ https://aurababy-hub0.onrender.com");

/* ===== SOCKET (NO FALLBACK POSSIBLE) ===== */
const socket = io("https://aurababy-hub0.onrender.com", {
  transports: ["websocket"],
  forceNew: true,
  reconnection: true
});

/* ===== APP ===== */
const { useState, useEffect, useRef } = React;

const babies = {
  aurababy:"https://i.ibb.co/nq467xv6/aurababy.png",
  goonerbaby:"https://i.ibb.co/ZRPGHj01/goonerbaby.png",
  fattiebaby:"https://i.ibb.co/Kj0gKt2Q/fattiebaby.png"
};

function App(){
  const [username,setUsername]=useState(localStorage.getItem("u"));
  const [input,setInput]=useState("");
  const [players,setPlayers]=useState({});
  const pos=useRef({x:200,y:200});
  const keys=useRef({});

  useEffect(()=>{
    socket.on("state",s=>{
      console.log("STATE",s);
      setPlayers(s);
    });
  },[]);

  useEffect(()=>{
    if(username) socket.emit("join",{username,character:"aurababy"});
  },[username]);

  useEffect(()=>{
    if(!username) return;
    window.onkeydown=e=>keys.current[e.key]=true;
    window.onkeyup=e=>keys.current[e.key]=false;
    const loop=()=>{
      if(keys.current.w) pos.current.y-=4;
      if(keys.current.s) pos.current.y+=4;
      if(keys.current.a) pos.current.x-=4;
      if(keys.current.d) pos.current.x+=4;
      socket.emit("move",pos.current);
      requestAnimationFrame(loop);
    };
    loop();
  },[username]);

  if(!username){
    return React.createElement("div",{className:"screen center"},
      React.createElement("div",{className:"box"},
        React.createElement("form",{onSubmit:e=>{
          e.preventDefault();
          localStorage.setItem("u",input);
          setUsername(input);
        }},
          React.createElement("input",{className:"input",onChange:e=>setInput(e.target.value),placeholder:"Username"}),
          React.createElement("button",{className:"button"},"Start")
        )
      )
    );
  }

  return React.createElement("div",{className:"screen"},
    React.createElement("div",{className:"grid-bg"}),
    Object.values(players).map(p=>
      React.createElement(React.Fragment,{key:p.id},
        React.createElement("div",{className:"player",style:{left:p.x,top:p.y}},
          React.createElement("img",{src:babies[p.character],style:{width:"100%",height:"100%"}})
        ),
        React.createElement("div",{className:"username-label",
          style:{left:p.x+24,top:p.y+56}},p.username)
      )
    ),
    React.createElement("div",{className:"hud"},"Players: "+Object.keys(players).length)
  );
}

ReactDOM.createRoot(document.getElementById("root"))
  .render(React.createElement(App));
</script>
</body>
</html>
